#!/bin/bash

# 通知送信テストとログ監視スクリプト
echo "==== 通知送信テストを開始します ===="
echo "$(date) - テスト開始"

# 通知API呼び出し
echo "■ 通知APIを呼び出します..."
curl -X POST http://localhost:8080/api/notification -v 2>&1

echo ""
echo "■ 通知が送信されました。フロントエンドのブラウザコンソールでログを確認してください。"
echo "■ 通知が2回表示された場合は、以下のテストポイントを確認してください："
echo ""
echo "1. バックエンドログの確認:"
echo "   - 同一トークンに対して複数回の送信がされていないか"
echo "   - sentTokensのカウントは期待通りか"
echo ""
echo "2. サービスワーカー(ブラウザコンソール)のログ確認:"
echo "   - 同一メッセージIDが複数回処理されていないか"
echo "   - キャッシュチェックが正しく機能しているか"
echo ""
echo "通知が1回だけ表示された場合、修正は成功しています。"
echo "$(date) - テスト終了"
echo "==== 通知送信テスト完了 ===="
